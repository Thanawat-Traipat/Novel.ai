import streamlit as st
import openai

# Sidebar input for OpenAI API key
user_api_key = st.sidebar.text_input("OpenAI API key", type="password", help="Enter your OpenAI API key to enable AI features.")

# Initialize OpenAI client only if the API key is provided
if user_api_key:
    client = openai.OpenAI(api_key=user_api_key)
else:
    client = None

# Function to interact with OpenAI API
def get_ai_response(prompt, character1, character2, genre):
    # Messages to guide the AI based on user input
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": f"The main characters are {character1} and {character2}. The genre is {genre}."}
    ]
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=messages
    )
    return response.choices[0].message.content

# Page title and description
st.markdown("""
# นิยายเกเสวๆ.AI

ใส่ชื่อพระเอก นายเอก แนวที่ต้องการ แล้วมาเสวไปด้วยกันเล้ย!
""")

# User inputs
character1 = st.text_input("ชื่อพระเอก", " ")
character2 = st.text_input("ชื่อนายเอก", " ")
genre = st.text_input("แนวที่ต้องการ", " ")

# AI prompt guiding the story generation
prompt = f"""
คุณเป็นสาววาย ม.ปลาย นักเขียนนิยายชายรักชายชื่อดัง คุณจะได้รับ prompt เป็น character1 คือพระเอก และcharacter2 คือนายเอก และ Genre คือแนวที่อยากได้ 
และคุณจะเขียนนิยายออกมา 
เขียนในสไตล์นี้ เอางี้เขียนตามนี้

เปลี่ยนไวท์เป็นCharacter2 และ เปลี่ยนกีตาร์เป็นCharacter1
เว้นบรรทัดตามนี้ด้วย 
"พี่รักผมแล้วใช่ไหม?"
"หุบปาก!" ร่างสูงตะคอกใส่ เมื่อไวท์เอาแต่ถามไม่หยุด
คำถามที่เขายังคงหาคำตอบไม่ได้
"ในเมื่อพี่ไม่ชอบผู้ชาย แล้วพี่เอากับผมทำไม!?" ไวท์ตะคอกถาม
"กูบอกให้หยุดไง!"
"ถ้าพี่ไม่รักผม แล้วพี่เอากับผมทำไม!?" ไวท์ยังคงพูดต่อ
"กูบอกให้หยุด!!"
"เลิกหลอกตัวเองซะ!!!"
ผลั๊ก!
ร่างสูงเหวี่ยงหมัดใส่หน้าอีกคน หน้าไวท์หันไปตามแรง ร่างเล็กจึงเอาลิ้นเล็กแตะที่มุมปาก ก่อนจะรับรู้ถึงกลิ่นของเลือด ทำให้ไวท์ยิ้มอ่อนๆที่มุมปาก
ครั้งแรกที่โดนต่อย...
"ฟังกูดีๆนะ...กู-ไม่-มี-วัน-รัก-มึง!" ร่างสูงพูด พร้อมแสยะยิ้มที่มุมปาก
"พี่ไม่ได้รักผมจริงๆหรอ?" แม้เสียงจะไม่ได้ตะคอกถามเหมือนตอนแรก แต่ก็ยังคงเป็นคำถามที่กีตาร์ไม่อยากได้ยิน
"มึงจะไม่หยุดพูดจริงๆใช่ไหม..." 
"อะ..อ่ะ.พี่กีต้าร์...อ๊าส์" เสียงเล็กเรียกชื่อคนตัวสูงที่อยู่ตรงไหนของห้องก็ไม่รู้ เพราะดวงตากลมถูกปิดด้วยผ้าสีดำสนิท
ร่างบางถูกจัดวางในท่านอนคว่ำ ใบหน้าแนบกับเตียงนอน ตามตัวโกงโค้ง ข้อมือทั้งสองถูกพาดไว้ด้านหลัง จนรู้สึกเจ็บไปหมด อกเล็กขยับขึ้นลงตามลมหายใจ
ดวงตาคู่สวยถูกปิดตาด้วยผ้าสีดำสนิท ลำคอขาวระหงส์มีปลอกคอสีดำที่ประดับด้วยหนามเหล็กสวมไว้ที่คอ โซ่ที่เชื่อมกับปลอกคอถูกมัดติดไว้ที่หัวเตียง ยอดอกที่ชูชันมีเครื่องสั่นเล็กๆแปะอยู่โดยสก็อตเทป แก่นกายเล็กมีแท่งเหล็กเล็กยาวสอดเข้าไปจนกระทั่งห่วงคล้องตรงส่วนปลายของแท่งชมพูเนื้ออย่างพอดี เพื่อไม่ให้ปลดปล่อย แถมยังมีลูกกลมๆเล็กๆ ถึง 2 ลูก ทำงานอยู่ภายในตัวของเขา ก่อนที่จะสะดุ้งตกใจ เมื่อรับรู้ว่ามีใครคร่อมตนไว้
"หึ! เสียวดีมั้ย?" ร่างสูงถาม ก่อนที่มือของเขาจะเลื่อนลงไปสัมผัสกับเนื้อน้อยของไวท์ พลางขบหูร่างเล็กเบาๆ ให้อีกคนได้เสียวเล่น
"อ่ะ!..อ๊า..ยะ.หยุดเถอะครับ ผมไม่ได้ อ๊ะ! ผมไม่ได้ตั้งใจ" ไวท์ครางเสียงกระเส่า พลางร้องห้าม เมื่อแรงสั่นของเครื่องเล่นแต่ละอันเพิ่มขึ้น อีกทั้งดิลโด้ได้ถูกสอดเข้ามาในช่องทางรักที่แคบๆ
"อื้มม..มม." ร่างสูงครางในลำคอ หลังจากเลื่อนหน้าจากใบหู ลงมายังซอกคอขาว ปากร้อนดูดซอกคอขาวจนเป็นรอยแดง เรียกเสียงครางได้เป็นอย่างดี อีกทั้งมือก็ยังขยับดิลโด้เข้าออกไม่หยุด จนไปชนกับลูกกลมๆด้านใน
"อ๊ะ!..อ่ะ...เอา..อึก!...เอามันออกไป..ผมเจ็บ ฮึก! เอามันออกไป" ร่างเล็กเริ่มสะบัดหัวไปมา เมื่อความเจ็บเกิดขึ้นบริเวณกลางลำตัว ไวท์เริ่มร้องไห้อีกครั้งด้วยความกลัวและความเจ็บ
"..." ร่างสูงค่อยๆแก้ผ้าปิดตาออก
"..." ดวงตาสีดำใสฉ่ำไปด้วยน้ำตา ร่างสูงจึงค่อยๆแกะสิ่งที่ติดอยู่บนยอดอกของไวท์ออกทั้งสองข้าง
"ทำไม? ไม่ไหวแล้วหรอ?"
"ฮือ~ ปล่อยผมไปเถอะ"
"กูเคยปล่อยแล้วนะ แต่มึงเสือกไม่ไปเอง"
"""

# Display a button to generate the story
if st.button('Generate Romance Novel') and user_api_key and character1 and character2 and genre:
    with st.spinner('กำลังสมองไหล'):
        # Get AI response
        ai_story = get_ai_response(prompt, character1, character2, genre)
        st.markdown("## นิยายเกเสวๆตามสั้ง")
        st.write(ai_story)
else:
    if not user_api_key:
        st.warning("Please provide your OpenAI API key to start generating your novel.")
    if not character1 or not character2:
        st.warning("Please provide names for both main characters.")
